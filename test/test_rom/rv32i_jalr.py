from amaranth import *
from src.rom import *

###########################################
# rv32ui JALR instruction tests:          #
###########################################

# Simulated ROM image:
jalr_rom = rom_img( [
  0x6F008004, 0x732F2034, 0x930F8000, 0x6308FF03, 
  0x930F9000, 0x6304FF03, 0x930FB000, 0x6300FF03, 
  0x130F0000, 0x63040F00, 0x67000F00, 0x732F2034, 
  0x63540F00, 0x6F004000, 0x93E19153, 0x170F0000, 
  0x23223F7C, 0x6FF09FFF, 0x732540F1, 0x63100500, 
  0x97020000, 0x93820201, 0x73905230, 0x73500018, 
  0x97020000, 0x9382C201, 0x73905230, 0x9302F0FF, 
  0x7390023B, 0x9302F001, 0x7390023A, 0x97020000, 
  0x93828201, 0x73905230, 0x73502030, 0x73503030, 
  0x73504030, 0x93010000, 0x97020000, 0x9382C2F6, 
  0x73905230, 0x13051000, 0x1315F501, 0x634A0500, 
  0x0F00F00F, 0x9308D005, 0x13050000, 0x6F004063, 
  0x93020000, 0x638E0200, 0x73905210, 0xB7B20000, 
  0x93829210, 0x73902230, 0x73232030, 0xE39E62F4, 
  0x73500030, 0x37250000, 0x13050580, 0x73200530, 
  0x97020000, 0x93824201, 0x73901234, 0x732540F1, 
  0x73002030, 0x930F0000, 0x631CF05F, 0x97020020, 
  0x938242FF, 0xB7DF0000, 0x938FCFCC, 0x17080000, 
  0x13084801, 0x67000800, 0xB72F0100, 0x938FBF3A, 
  0x23A0F201, 0x37D30000, 0x1303C3CC, 0x63926F5C, 
  0x37DF0000, 0x130FCFCC, 0x97070000, 0x93873701, 
  0xE7801700, 0x372F0100, 0x130FBF3A, 0x23A2E201, 
  0x37D30000, 0x1303C3CC, 0x631C6F58, 0x6F008000, 
  0x6F000002, 0xB7DE0000, 0x938ECECC, 0x17070000, 
  0x130737FF, 0x67011700, 0xB72E0100, 0x938EBE3A, 
  0x23A4D201, 0x37D30000, 0x1303C3CC, 0x63926E56, 
  0x37DE0000, 0x130ECECC, 0x97060000, 0x93860601, 
  0xE7814600, 0x372E0100, 0x130EBE3A, 0x23A6C201, 
  0x37D30000, 0x1303C3CC, 0x631C6E52, 0xB7DD0000, 
  0x938DCDCC, 0x17060000, 0x13062601, 0x67022600, 
  0xB72D0100, 0x938DBD3A, 0x23A8B201, 0x37D30000, 
  0x1303C3CC, 0x63966D50, 0x97000020, 0x9380C0F1, 
  0x37DD0000, 0x130DCDCC, 0x97050000, 0x93850501, 
  0xE7824500, 0x372D0100, 0x130DBD3A, 0x23A0A001, 
  0x37D10000, 0x1301C1CC, 0x631C2D4C, 0xB7DC0000, 
  0x938CCCCC, 0x17050000, 0x13051501, 0x67033500, 
  0xB72C0100, 0x938CBC3A, 0x23A29001, 0x37D10000, 
  0x1301C1CC, 0x63962C4A, 0x6F008000, 0x6F000002, 
  0x37DC0000, 0x130CCCCC, 0x97040000, 0x938424FF, 
  0xE7832400, 0x372C0100, 0x130CBC3A, 0x23A48001, 
  0x37D10000, 0x1301C1CC, 0x631C2C46, 0xB7DB0000, 
  0x938BCBCC, 0x17040000, 0x13044401, 0x67040400, 
  0xB72B0100, 0x938BBB3A, 0x23A67001, 0x37D10000, 
  0x1301C1CC, 0x63962B44, 0x37DB0000, 0x130BCBCC, 
  0x97030000, 0x93833301, 0xE7841300, 0x372B0100, 
  0x130BBB3A, 0x23A86001, 0x37D10000, 0x1301C1CC, 
  0x63102B42, 0x97000020, 0x938040E4, 0xB7DA0000, 
  0x938ACACC, 0x17030000, 0x13033301, 0x67051300, 
  0xB72A0100, 0x938ABA3A, 0x23A05001, 0xB7D30000, 
  0x9383C3CC, 0x63967A3E, 0x37DA0000, 0x130ACACC, 
  0x97020000, 0x93820201, 0xE7854200, 0x372A0100, 
  0x130ABA3A, 0x23A24001, 0xB7D30000, 0x9383C3CC, 
  0x63107A3C, 0x6F008000, 0x6F000002, 0xB7D90000, 
  0x9389C9CC, 0x17020000, 0x130222FF, 0x67062200, 
  0xB7290100, 0x9389B93A, 0x23A43001, 0xB7D30000, 
  0x9383C3CC, 0x63967938, 0x37D90000, 0x1309C9CC, 
  0x97010000, 0x93810101, 0xE7864100, 0x37290100, 
  0x1309B93A, 0x23A62001, 0xB7D30000, 0x9383C3CC, 
  0x63107936, 0xB7D80000, 0x9388C8CC, 0x17010000, 
  0x13011101, 0x67073100, 0xB7280100, 0x9388B83A, 
  0x23A81001, 0xB7D30000, 0x9383C3CC, 0x639A7832, 
  0x17010020, 0x1301C1D6, 0x37D80000, 0x1308C8CC, 
  0x97000000, 0x93802001, 0xE7872000, 0x37280100, 
  0x1308B83A, 0x23200101, 0xB7D10000, 0x9381C1CC, 
  0x63103830, 0xB7D70000, 0x9387C7CC, 0x97000000, 
  0x93804001, 0x67880000, 0xB7270100, 0x9387B73A, 
  0x2322F100, 0xB7D10000, 0x9381C1CC, 0x639A372C, 
  0x6F008000, 0x6F000002, 0x37D70000, 0x1307C7CC, 
  0x970F0000, 0x938F3FFF, 0xE7881F00, 0x37270100, 
  0x1307B73A, 0x2324E100, 0xB7D10000, 0x9381C1CC, 
  0x6310372A, 0xB7D60000, 0x9386C6CC, 0x170F0000, 
  0x130F3F01, 0x67091F00, 0xB7260100, 0x9386B63A, 
  0x2326D100, 0xB7D10000, 0x9381C1CC, 0x639A3626, 
  0x37D60000, 0x1306C6CC, 0x970E0000, 0x938E0E01, 
  0xE7894E00, 0x37260100, 0x1306B63A, 0x2328C100, 
  0xB7D10000, 0x9381C1CC, 0x63143624, 0x97000020, 
  0x938040C9, 0xB7D50000, 0x9385C5CC, 0x170E0000, 
  0x130E2E01, 0x670A2E00, 0xB7250100, 0x9385B53A, 
  0x23A0B000, 0x37D10000, 0x1301C1CC, 0x639A2520, 
  0x37D50000, 0x1305C5CC, 0x970D0000, 0x938D0D01, 
  0xE78A4D00, 0x37250100, 0x1305B53A, 0x23A2A000, 
  0x37D10000, 0x1301C1CC, 0x6314251E, 0x6F008000, 
  0x6F000002, 0xB7D40000, 0x9384C4CC, 0x170D0000, 
  0x130D1DFF, 0x670B3D00, 0xB7240100, 0x9384B43A, 
  0x23A49000, 0x37D10000, 0x1301C1CC, 0x639A241A, 
  0x37D40000, 0x1304C4CC, 0x970C0000, 0x938C2C01, 
  0xE78B2C00, 0x37240100, 0x1304B43A, 0x23A68000, 
  0x37D10000, 0x1301C1CC, 0x63142418, 0xB7D30000, 
  0x9383C3CC, 0x170C0000, 0x130C4C01, 0x670C0C00, 
  0xB7230100, 0x9383B33A, 0x23A87000, 0x37D10000, 
  0x1301C1CC, 0x639E2314, 0x97000020, 0x9380C0BB, 
  0x37D30000, 0x1303C3CC, 0x970B0000, 0x938B3B01, 
  0xE78C1B00, 0x37230100, 0x1303B33A, 0x23A06000, 
  0xB7D30000, 0x9383C3CC, 0x63147312, 0xB7D20000, 
  0x9382C2CC, 0x170B0000, 0x130B3B01, 0x670D1B00, 
  0xB7220100, 0x9382B23A, 0x23A25000, 0xB7D30000, 
  0x9383C3CC, 0x639E720E, 0x6F008000, 0x6F000002, 
  0x37D20000, 0x1302C2CC, 0x970A0000, 0x938A0AFF, 
  0xE78D4A00, 0x37220100, 0x1302B23A, 0x23A44000, 
  0xB7D30000, 0x9383C3CC, 0x6314720C, 0xB7D10000, 
  0x9381C1CC, 0x170A0000, 0x130A2A01, 0x670E2A00, 
  0xB7210100, 0x9381B13A, 0x23A63000, 0xB7D30000, 
  0x9383C3CC, 0x639E7108, 0x37D10000, 0x1301C1CC, 
  0x97090000, 0x93890901, 0xE78E4900, 0x37210100, 
  0x1301B13A, 0x23A82000, 0xB7D30000, 0x9383C3CC, 
  0x63187106, 0x17010020, 0x130141AE, 0xB7D00000, 
  0x9380C0CC, 0x17090000, 0x13091901, 0x670F3900, 
  0xB7200100, 0x9380B03A, 0x23201100, 0xB7D10000, 
  0x9381C1CC, 0x639E3002, 0x37D00000, 0x1300C0CC, 
  0x97080000, 0x93882801, 0xE78F2800, 0x37200100, 
  0x1300B03A, 0x23220100, 0x93010000, 0x631A3000, 
  0x0F00F00F, 0x9308D005, 0x13050000, 0x6FF05FFF, 
  0x0F00F00F, 0x9308D005, 0x37150000, 0x1305D5BA, 
  0x6FF01FFF, 0x731000C0, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000
] )

# Simulated initialized RAM image:
jalr_ram = ram_img( [
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x80000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000
] )

# Expected 'pass' register values.
jalr_exp = {
  1152: [ { 'r': 17, 'e': 93 }, { 'r': 10, 'e': 0 } ],  'end': 1152
}

# Collected test program definition:
jalr_test = [ 'JALR compliance tests', 'cpu_jalr', jalr_rom, jalr_ram, jalr_exp ]