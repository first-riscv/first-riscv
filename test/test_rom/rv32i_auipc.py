from amaranth import *
from src.rom import *

###########################################
# rv32ui AUIPC instruction tests:         #
###########################################

# Simulated ROM image:
auipc_rom = rom_img( [
  0x6F004004, 0x732F2034, 0x930F8000, 0x6308FF03, 
  0x930F9000, 0x6304FF03, 0x930FB000, 0x6300FF03, 
  0x130F0000, 0x63040F00, 0x67000F00, 0x732F2034, 
  0x63540F00, 0x6F004000, 0x93E19153, 0x23203050, 
  0x6FF0DFFF, 0x732540F1, 0x63100500, 0x97020000, 
  0x93820201, 0x73905230, 0x73500018, 0x97020000, 
  0x9382C201, 0x73905230, 0x9302F0FF, 0x7390023B, 
  0x9302F001, 0x7390023A, 0x97020000, 0x93828201, 
  0x73905230, 0x73502030, 0x73503030, 0x73504030, 
  0x93010000, 0x97020000, 0x938202F7, 0x73905230, 
  0x13051000, 0x1315F501, 0x634A0500, 0x0F00F00F, 
  0x9308D005, 0x13050000, 0x6F008040, 0x93020000, 
  0x638E0200, 0x73905210, 0xB7B20000, 0x93829210, 
  0x73902230, 0x73232030, 0xE39062F6, 0x73500030, 
  0x37250000, 0x13050580, 0x73200530, 0x97020000, 
  0x93824201, 0x73901234, 0x732540F1, 0x73002030, 
  0x930F0000, 0x6316F03D, 0x97020020, 0x938282FF, 
  0x17000000, 0x97030000, 0x9383C3FF, 0x33007040, 
  0x23A00200, 0x13030000, 0x6314603A, 0x97000000, 
  0x97030000, 0x9383C3FF, 0xB3807040, 0x23A21200, 
  0x13030000, 0x63966038, 0x17F17F00, 0x97030000, 
  0x9383C3FF, 0x33017140, 0x23A42200, 0x37F37F00, 
  0x63186136, 0x97110000, 0x97030000, 0x9383C3FF, 
  0xB3817140, 0x23A63200, 0x37130000, 0x639A6134, 
  0x17422301, 0x97030000, 0x9383C3FF, 0x33027240, 
  0x23A84200, 0x37432301, 0x631C6232, 0x97000020, 
  0x938080F7, 0x97020080, 0x97010000, 0x9381C1FF, 
  0xB3823240, 0x23A05000, 0x37010080, 0x639A2230, 
  0x17432301, 0x97010000, 0x9381C1FF, 0x33033340, 
  0x23A26000, 0x37412301, 0x631C232E, 0x97F3FFFF, 
  0x97010000, 0x9381C1FF, 0xB3833340, 0x23A47000, 
  0x37F1FFFF, 0x639E232C, 0x17140000, 0x97010000, 
  0x9381C1FF, 0x33043440, 0x23A68000, 0x37110000, 
  0x6310242C, 0x97F4FF7F, 0x97010000, 0x9381C1FF, 
  0xB3843440, 0x23A89000, 0x37F1FF7F, 0x6392242A, 
  0x97000020, 0x938080EF, 0x17153254, 0x17040000, 
  0x1304C4FF, 0x33058540, 0x23A0A000, 0xB7133254, 
  0x63107528, 0x97058000, 0x17040000, 0x1304C4FF, 
  0xB3858540, 0x23A2B000, 0xB7038000, 0x63927526, 
  0x17060000, 0x17040000, 0x1304C4FF, 0x33068640, 
  0x23A4C000, 0x93030000, 0x63147624, 0x97F67F00, 
  0x17040000, 0x1304C4FF, 0xB3868640, 0x23A6D000, 
  0xB7F37F00, 0x63967622, 0x17070000, 0x17040000, 
  0x1304C4FF, 0x33078740, 0x23A8E000, 0x93030000, 
  0x63187720, 0x17010020, 0x130181E7, 0x97170000, 
  0x17020000, 0x1302C2FF, 0xB3874740, 0x2320F100, 
  0xB7110000, 0x6396371E, 0x17080000, 0x17020000, 
  0x1302C2FF, 0x33084840, 0x23220101, 0x93010000, 
  0x6318381C, 0x97080000, 0x17020000, 0x1302C2FF, 
  0xB3884840, 0x23241101, 0x93010000, 0x639A381A, 
  0x17F97F00, 0x17020000, 0x1302C2FF, 0x33094940, 
  0x23262101, 0xB7F17F00, 0x631C3918, 0x97190000, 
  0x17020000, 0x1302C2FF, 0xB3894940, 0x23283101, 
  0xB7110000, 0x639E3916, 0x97000020, 0x938080DF, 
  0x174A2301, 0x97010000, 0x9381C1FF, 0x330A3A40, 
  0x23A04001, 0x37412301, 0x631C2A14, 0x970A0080, 
  0x97010000, 0x9381C1FF, 0xB38A3A40, 0x23A25001, 
  0x37010080, 0x639E2A12, 0x174B2301, 0x97010000, 
  0x9381C1FF, 0x330B3B40, 0x23A46001, 0x37412301, 
  0x63102B12, 0x97FBFFFF, 0x97010000, 0x9381C1FF, 
  0xB38B3B40, 0x23A67001, 0x37F1FFFF, 0x63922B10, 
  0x171C0000, 0x97010000, 0x9381C1FF, 0x330C3C40, 
  0x23A88001, 0x37110000, 0x63142C0E, 0x97000020, 
  0x938080D7, 0x97FCFF7F, 0x17040000, 0x1304C4FF, 
  0xB38C8C40, 0x23A09001, 0xB7F3FF7F, 0x63927C0C, 
  0x171D3254, 0x17040000, 0x1304C4FF, 0x330D8D40, 
  0x23A2A001, 0xB7133254, 0x63147D0A, 0x970D8000, 
  0x17040000, 0x1304C4FF, 0xB38D8D40, 0x23A4B001, 
  0xB7038000, 0x63967D08, 0x170E0000, 0x17040000, 
  0x1304C4FF, 0x330E8E40, 0x23A6C001, 0x93030000, 
  0x63187E06, 0x97FE7F00, 0x17040000, 0x1304C4FF, 
  0xB38E8E40, 0x23A8D001, 0xB7F37F00, 0x639A7E04, 
  0x17010020, 0x130181CF, 0x170F0000, 0x17020000, 
  0x1302C2FF, 0x330F4F40, 0x2320E101, 0x93010000, 
  0x63183F02, 0x971F0000, 0x17020000, 0x1302C2FF, 
  0xB38F4F40, 0x2322F101, 0xB7110000, 0x639A3F00, 
  0x0F00F00F, 0x9308D005, 0x13050000, 0x6FF05FFF, 
  0x0F00F00F, 0x9308D005, 0x37150000, 0x1305D5BA, 
  0x6FF01FFF, 0x731000C0, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000
] )

# Simulated initialized RAM image:
auipc_ram = ram_img( [
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x80000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000
] )

# Expected 'pass' register values.
auipc_exp = {
  768: [ { 'r': 17, 'e': 93 }, { 'r': 10, 'e': 0 } ],  'end': 768
}

# Collected test program definition:
auipc_test = [ 'AUIPC compliance tests', 'cpu_auipc', auipc_rom, auipc_ram, auipc_exp ]