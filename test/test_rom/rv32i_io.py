from amaranth import *
from src.rom import *

###########################################
# rv32ui IO instruction tests:            #
###########################################

# Simulated ROM image:
io_rom = rom_img( [
  0x6F004004, 0x732F2034, 0x930F8000, 0x6308FF03, 
  0x930F9000, 0x6304FF03, 0x930FB000, 0x6300FF03, 
  0x130F0000, 0x63040F00, 0x67000F00, 0x732F2034, 
  0x63540F00, 0x6F004000, 0x93E19153, 0x23203060, 
  0x6FF0DFFF, 0x732540F1, 0x63100500, 0x97020000, 
  0x93820201, 0x73905230, 0x73500018, 0x97020000, 
  0x9382C201, 0x73905230, 0x9302F0FF, 0x7390023B, 
  0x9302F001, 0x7390023A, 0x97020000, 0x93828201, 
  0x73905230, 0x73502030, 0x73503030, 0x73504030, 
  0x93010000, 0x97020000, 0x938202F7, 0x73905230, 
  0x13051000, 0x1315F501, 0x634A0500, 0x0F00F00F, 
  0x9308D005, 0x13050000, 0x6F000049, 0x93020000, 
  0x638E0200, 0x73905210, 0xB7B20000, 0x93829210, 
  0x73902230, 0x73232030, 0xE39062F6, 0x73500030, 
  0x37250000, 0x13050580, 0x73200530, 0x97020000, 
  0x93824201, 0x73901234, 0x732540F1, 0x73002030, 
  0x930F0000, 0x631AF045, 0x97000020, 0x938080FF, 
  0x17010020, 0x13010102, 0x83A10000, 0x13020000, 
  0x93021000, 0x1303F0FF, 0xB7030080, 0x9383F3FF, 
  0x37040080, 0x33824100, 0xB3825100, 0x33836100, 
  0xB3837100, 0x33848100, 0x23203100, 0x23224100, 
  0x23245100, 0x23266100, 0x23287100, 0x232A8100, 
  0x13010000, 0x639A213E, 0x13010000, 0x6316223E, 
  0x13011000, 0x6392223E, 0x1301F0FF, 0x631E233C, 
  0x37010080, 0x1301F1FF, 0x6398233C, 0x37010080, 
  0x6314243C, 0x97000020, 0x938000F7, 0x17010020, 
  0x1301C1FA, 0x03A40000, 0x93040000, 0x13051000, 
  0x9305F0FF, 0x37060080, 0x1306F6FF, 0xB7060080, 
  0xB3049400, 0x3305A400, 0xB305B400, 0x3306C400, 
  0xB306D400, 0x23208100, 0x23229100, 0x2324A100, 
  0x2326B100, 0x2328C100, 0x232AD100, 0x13011000, 
  0x63142436, 0x13011000, 0x63902436, 0x13012000, 
  0x631C2534, 0x13010000, 0x63982534, 0x37010080, 
  0x63142634, 0x37010080, 0x13011100, 0x639E2632, 
  0x97000020, 0x938080EE, 0x17010020, 0x130181F3, 
  0x83A60000, 0x13070000, 0x93071000, 0x1308F0FF, 
  0xB7080080, 0x9388F8FF, 0x37090080, 0x3387E600, 
  0xB387F600, 0x33880601, 0xB3881601, 0x33892601, 
  0x2320D100, 0x2322E100, 0x2324F100, 0x23260101, 
  0x23281101, 0x232A2101, 0x1301F0FF, 0x639E262C, 
  0x1301F0FF, 0x631A272C, 0x13010000, 0x6396272C, 
  0x1301E0FF, 0x6312282C, 0x37010080, 0x1301E1FF, 
  0x639C282A, 0x37010080, 0x1301F1FF, 0x6316292A, 
  0x97000020, 0x9380C0E5, 0x17010020, 0x130101EC, 
  0x03A90000, 0x93090000, 0x130A1000, 0x930AF0FF, 
  0x370B0080, 0x130BFBFF, 0xB70B0080, 0xB3093901, 
  0x330A4901, 0xB30A5901, 0x330B6901, 0xB30B7901, 
  0x23202101, 0x23223101, 0x23244101, 0x23265101, 
  0x23286101, 0x232A7101, 0x37010080, 0x1301F1FF, 
  0x63142924, 0x37010080, 0x1301F1FF, 0x639E2922, 
  0x37010080, 0x631A2A22, 0x37010080, 0x1301E1FF, 
  0x63942A22, 0x1301E0FF, 0x63102B22, 0x1301F0FF, 
  0x639C2B20, 0x97000020, 0x9380C0DC, 0x17010020, 
  0x130141E4, 0x83AB0000, 0x130C0000, 0x930C1000, 
  0x130DF0FF, 0xB70D0080, 0x938DFDFF, 0x370E0080, 
  0x338C8B01, 0xB38C9B01, 0x338DAB01, 0xB38DBB01, 
  0x338ECB01, 0x23207101, 0x23228101, 0x23249101, 
  0x2326A101, 0x2328B101, 0x232AC101, 0x37010080, 
  0x639C2B1A, 0x37010080, 0x63182C1A, 0x37010080, 
  0x13011100, 0x63922C1A, 0x37010080, 0x1301F1FF, 
  0x631C2D18, 0x1301F0FF, 0x63982D18, 0x13010000, 
  0x63142E18, 0x970C0020, 0x938C0CD4, 0x170D0020, 
  0x130DCDDC, 0x03AE0C00, 0x930D1000, 0xB30EBE01, 
  0x338FBE01, 0xB30FBF01, 0xB380BF01, 0x3381B001, 
  0xB301B101, 0x2320BD01, 0x2322CD01, 0x2324DD01, 
  0x2326ED01, 0x2328FD01, 0x232A1D00, 0x232C2D00, 
  0x232E3D00, 0x130D1000, 0x6398AD13, 0x37BD0000, 
  0x130DDDBC, 0x6312AE13, 0x37BD0000, 0x130DEDBC, 
  0x639CAE11, 0x37BD0000, 0x130DFDBC, 0x6316AF11, 
  0x37BD0000, 0x130D0DBD, 0x6390AF11, 0x37BD0000, 
  0x130D1DBD, 0x639AA00F, 0x37BD0000, 0x130D2DBD, 
  0x6314A10F, 0x37BD0000, 0x130D3DBD, 0x639EA10D, 
  0x97000020, 0x938080C9, 0x17010020, 0x130101D4, 
  0x03AE0000, 0xB79DFFF7, 0x938D8D81, 0x3300BE01, 
  0x23200100, 0x13010000, 0x6318200A, 0x97000020, 
  0x938000C7, 0x17010020, 0x130181D1, 0x03AE0000, 
  0xB79DFFF7, 0x938D8D81, 0x3300BE01, 0xB3020000, 
  0x23200100, 0x23225100, 0x13010000, 0x631E2006, 
  0x97000020, 0x938000C4, 0x17010020, 0x1301C1CE, 
  0x83A10000, 0x33820100, 0xB3020200, 0x33035000, 
  0x33070300, 0xB3070700, 0x33880700, 0xB30C0001, 
  0x330D9001, 0xB30D0D00, 0x23204100, 0x2322A101, 
  0x2324B101, 0x37619236, 0x13014181, 0x63162202, 
  0x37619236, 0x13014181, 0x63102D02, 0x37619236, 
  0x13014181, 0x639A2D00, 0x0F00F00F, 0x9308D005, 
  0x13050000, 0x6FF05FFF, 0x0F00F00F, 0x9308D005, 
  0x37150000, 0x1305D5BA, 0x6FF01FFF, 0x731000C0, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000
] )

# Simulated initialized RAM image:
io_ram = ram_img( [
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x01000000, 0xFFFFFFFF, 0xFFFFFF7F, 
  0x00000080, 0xCDAB0000, 0x78563412, 0x98BADCFE, 
  0x14589236, 0x00000000, 0x00000000, 0x00000000, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x80000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000
] )

# Expected 'pass' register values.
io_exp = {
  896: [ { 'r': 17, 'e': 93 }, { 'r': 10, 'e': 0 } ],  'end': 896
}

# Collected test program definition:
io_test = [ 'IO compliance tests', 'cpu_io', io_rom, io_ram, io_exp ]