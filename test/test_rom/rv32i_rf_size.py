from amaranth import *
from src.rom import *

###########################################
# rv32ui RF_SIZE instruction tests:       #
###########################################

# Simulated ROM image:
rf_size_rom = rom_img( [
  0x6F004004, 0x732F2034, 0x930F8000, 0x6308FF03, 
  0x930F9000, 0x6304FF03, 0x930FB000, 0x6300FF03, 
  0x130F0000, 0x63040F00, 0x67000F00, 0x732F2034, 
  0x63540F00, 0x6F004000, 0x93E19153, 0x23203050, 
  0x6FF0DFFF, 0x732540F1, 0x63100500, 0x97020000, 
  0x93820201, 0x73905230, 0x73500018, 0x97020000, 
  0x9382C201, 0x73905230, 0x9302F0FF, 0x7390023B, 
  0x9302F001, 0x7390023A, 0x97020000, 0x93828201, 
  0x73905230, 0x73502030, 0x73503030, 0x73504030, 
  0x93010000, 0x97020000, 0x938202F7, 0x73905230, 
  0x13051000, 0x1315F501, 0x634A0500, 0x0F00F00F, 
  0x9308D005, 0x13050000, 0x6F004037, 0x93020000, 
  0x638E0200, 0x73905210, 0xB7B20000, 0x93829210, 
  0x73902230, 0x73232030, 0xE39062F6, 0x73500030, 
  0x37250000, 0x13050580, 0x73200530, 0x97020000, 
  0x93824201, 0x73901234, 0x732540F1, 0x73002030, 
  0x930F0000, 0x631CF033, 0x17080020, 0x130888FF, 
  0x37707242, 0x1300F0E6, 0xB7303356, 0x93809024, 
  0x3721562D, 0x13012105, 0xB7716952, 0x93813136, 
  0x37826B73, 0x13020292, 0xB7627473, 0x93822257, 
  0x3753206E, 0x1303F3E6, 0xB773694D, 0x938313C6, 
  0x3764646F, 0x13043417, 0xB744796B, 0x93843406, 
  0x37756574, 0x13053527, 0xB7756E28, 0x938535F7, 
  0x37266B65, 0x13068604, 0xB7665220, 0x93864616, 
  0x37376D6F, 0x1307C792, 0xB7377069, 0x938737E6, 
  0x23200800, 0x23221800, 0x23242800, 0x23263800, 
  0x23284800, 0x232A5800, 0x232C6800, 0x232E7800, 
  0x23208802, 0x23229802, 0x2324A802, 0x2326B802, 
  0x2328C802, 0x232AD802, 0x232CE802, 0x232EF802, 
  0x13080000, 0x63140027, 0x37383356, 0x13089824, 
  0x639E0025, 0x3728562D, 0x13082805, 0x63180125, 
  0x37786952, 0x13083836, 0x63920125, 0x37886B73, 
  0x13080892, 0x631C0223, 0x37687473, 0x13082857, 
  0x63960223, 0x3758206E, 0x1308F8E6, 0x63100323, 
  0x3778694D, 0x130818C6, 0x639A0321, 0x3768646F, 
  0x13083817, 0x63140421, 0x3748796B, 0x13083806, 
  0x639E041F, 0x37786574, 0x13083827, 0x6318051F, 
  0x37786E28, 0x130838F7, 0x6392051F, 0x37286B65, 
  0x13088804, 0x631C061D, 0x37685220, 0x13084816, 
  0x6396061D, 0x37386D6F, 0x1308C892, 0x6310071D, 
  0x37387069, 0x130838E6, 0x639A071B, 0x17020020, 
  0x130242EB, 0x37686F63, 0x13081846, 0xB778656A, 
  0x938808B4, 0x37792820, 0x13091986, 0xB7696A61, 
  0x9389B956, 0x376A7661, 0x130A0A52, 0xB75A202E, 
  0x938A5AC6, 0x377B6F63, 0x130B9BD2, 0xB77B6973, 
  0x938BEB02, 0x378C2066, 0x130CFC96, 0xB72C6567, 
  0x938C9C06, 0x377D7365, 0x130D1D36, 0xB72D7375, 
  0x938DDD06, 0x371E293A, 0x130EAED0, 0xB77E6968, 
  0x938E0E32, 0x372F6461, 0x130F4F07, 0xB77F2075, 
  0x938F5F26, 0x23200201, 0x23221201, 0x23242201, 
  0x23263201, 0x23284201, 0x232A5201, 0x232C6201, 
  0x232E7201, 0x23208203, 0x23229203, 0x2324A203, 
  0x2326B203, 0x2328C203, 0x232AD203, 0x232CE203, 
  0x232EF203, 0x37626F63, 0x13021246, 0x6310480E, 
  0x3772656A, 0x130202B4, 0x639A480C, 0x37722820, 
  0x13021286, 0x6314490C, 0x37626A61, 0x1302B256, 
  0x639E490A, 0x37627661, 0x13020252, 0x63184A0A, 
  0x3752202E, 0x130252C6, 0x63924A0A, 0x37726F63, 
  0x130292D2, 0x631C4B08, 0x37726973, 0x1302E202, 
  0x63964B08, 0x37822066, 0x1302F296, 0x63104C08, 
  0x37226567, 0x13029206, 0x639A4C06, 0x37727365, 
  0x13021236, 0x63144D06, 0x37227375, 0x1302D206, 
  0x639E4D04, 0x3712293A, 0x1302A2D0, 0x63184E04, 
  0x37726968, 0x13020232, 0x63924E04, 0x37226461, 
  0x13024207, 0x631C4F02, 0x37722075, 0x13025226, 
  0x63964F02, 0x17020020, 0x1302C2D6, 0x23200200, 
  0x23221200, 0x23242200, 0x23263200, 0x0F00F00F, 
  0x9308D005, 0x13050000, 0x6FF05FFF, 0x0F00F00F, 
  0x9308D005, 0x37150000, 0x1305D5BA, 0x6FF01FFF, 
  0x731000C0, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000
] )

# Simulated initialized RAM image:
rf_size_ram = ram_img( [
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x80000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000
] )

# Expected 'pass' register values.
rf_size_exp = {
  768: [ { 'r': 17, 'e': 93 }, { 'r': 10, 'e': 0 } ],  'end': 768
}

# Collected test program definition:
rf_size_test = [ 'RF_SIZE compliance tests', 'cpu_rf_size', rf_size_rom, rf_size_ram, rf_size_exp ]