from amaranth import *
from src.rom import *

###########################################
# rv32ui JAL instruction tests:           #
###########################################

# Simulated ROM image:
jal_rom = rom_img( [
  0x6F004004, 0x732F2034, 0x930F8000, 0x6308FF03, 
  0x930F9000, 0x6304FF03, 0x930FB000, 0x6300FF03, 
  0x130F0000, 0x63040F00, 0x67000F00, 0x732F2034, 
  0x63540F00, 0x6F004000, 0x93E19153, 0x23203070, 
  0x6FF0DFFF, 0x732540F1, 0x63100500, 0x97020000, 
  0x93820201, 0x73905230, 0x73500018, 0x97020000, 
  0x9382C201, 0x73905230, 0x9302F0FF, 0x7390023B, 
  0x9302F001, 0x7390023A, 0x97020000, 0x93828201, 
  0x73905230, 0x73502030, 0x73503030, 0x73504030, 
  0x93010000, 0x97020000, 0x938202F7, 0x73905230, 
  0x13051000, 0x1315F501, 0x634A0500, 0x0F00F00F, 
  0x9308D005, 0x13050000, 0x6F004053, 0x93020000, 
  0x638E0200, 0x73905210, 0xB7B20000, 0x93829210, 
  0x73902230, 0x73232030, 0xE39062F6, 0x73500030, 
  0x37250000, 0x13050580, 0x73200530, 0x97020000, 
  0x93824201, 0x73901234, 0x732540F1, 0x73002030, 
  0x930F0000, 0x631CF04F, 0x97020020, 0x938282FF, 
  0x37D00000, 0x1300C0CC, 0xEF0FC000, 0x37200100, 
  0x1300B03A, 0x23A00200, 0x13030000, 0x6318604C, 
  0xB7D00000, 0x9380C0CC, 0x6F0FC000, 0xB7200100, 
  0x9380B03A, 0x23A21200, 0x37D30000, 0x1303C3CC, 
  0x6396604A, 0x6F008000, 0x6F008001, 0x37D10000, 
  0x1301C1CC, 0xEFFE5FFF, 0x37210100, 0x1301B13A, 
  0x23A42200, 0x37D30000, 0x1303C3CC, 0x63106148, 
  0xB7D10000, 0x9381C1CC, 0x6F0EC000, 0xB7210100, 
  0x9381B13A, 0x23A63200, 0x37D30000, 0x1303C3CC, 
  0x639E6144, 0x37D20000, 0x1302C2CC, 0xEF0DC000, 
  0x37220100, 0x1302B23A, 0x23A84200, 0x37D30000, 
  0x1303C3CC, 0x631C6242, 0x97000020, 0x9380C0F4, 
  0xB7D20000, 0x9382C2CC, 0x6F0DC000, 0xB7220100, 
  0x9382B23A, 0x23A05000, 0x37D10000, 0x1301C1CC, 
  0x63962240, 0x37D30000, 0x1303C3CC, 0xEF0CC000, 
  0x37230100, 0x1303B33A, 0x23A26000, 0x37D10000, 
  0x1301C1CC, 0x6314233E, 0x6F008000, 0x6F008001, 
  0xB7D30000, 0x9383C3CC, 0x6FFC5FFF, 0xB7230100, 
  0x9383B33A, 0x23A47000, 0x37D10000, 0x1301C1CC, 
  0x639E233A, 0x37D40000, 0x1304C4CC, 0xEF0BC000, 
  0x37240100, 0x1304B43A, 0x23A68000, 0x37D10000, 
  0x1301C1CC, 0x631C2438, 0xB7D40000, 0x9384C4CC, 
  0x6F0BC000, 0xB7240100, 0x9384B43A, 0x23A89000, 
  0x37D10000, 0x1301C1CC, 0x639A2436, 0x97000020, 
  0x9380C0E9, 0x37D50000, 0x1305C5CC, 0xEF0AC000, 
  0x37250100, 0x1305B53A, 0x23A0A000, 0xB7D30000, 
  0x9383C3CC, 0x63147534, 0xB7D50000, 0x9385C5CC, 
  0x6F0AC000, 0xB7250100, 0x9385B53A, 0x23A2B000, 
  0xB7D30000, 0x9383C3CC, 0x63927532, 0x6F008000, 
  0x6F008001, 0x37D60000, 0x1306C6CC, 0xEFF95FFF, 
  0x37260100, 0x1306B63A, 0x23A4C000, 0xB7D30000, 
  0x9383C3CC, 0x631C762E, 0xB7D60000, 0x9386C6CC, 
  0x6F09C000, 0xB7260100, 0x9386B63A, 0x23A6D000, 
  0xB7D30000, 0x9383C3CC, 0x639A762C, 0x37D70000, 
  0x1307C7CC, 0xEF08C000, 0x37270100, 0x1307B73A, 
  0x23A8E000, 0xB7D30000, 0x9383C3CC, 0x6318772A, 
  0x17010020, 0x1301C1DE, 0xB7D70000, 0x9387C7CC, 
  0x6F08C000, 0xB7270100, 0x9387B73A, 0x2320F100, 
  0xB7D10000, 0x9381C1CC, 0x63923728, 0x37D80000, 
  0x1308C8CC, 0xEF07C000, 0x37280100, 0x1308B83A, 
  0x23220101, 0xB7D10000, 0x9381C1CC, 0x63103826, 
  0x6F008000, 0x6F008001, 0xB7D80000, 0x9388C8CC, 
  0x6FF75FFF, 0xB7280100, 0x9388B83A, 0x23241101, 
  0xB7D10000, 0x9381C1CC, 0x639A3822, 0x37D90000, 
  0x1309C9CC, 0xEF06C000, 0x37290100, 0x1309B93A, 
  0x23262101, 0xB7D10000, 0x9381C1CC, 0x63183920, 
  0xB7D90000, 0x9389C9CC, 0x6F06C000, 0xB7290100, 
  0x9389B93A, 0x23283101, 0xB7D10000, 0x9381C1CC, 
  0x6396391E, 0x97000020, 0x9380C0D3, 0x37DA0000, 
  0x130ACACC, 0xEF05C000, 0x372A0100, 0x130ABA3A, 
  0x23A04001, 0x37D10000, 0x1301C1CC, 0x63102A1C, 
  0xB7DA0000, 0x938ACACC, 0x6F05C000, 0xB72A0100, 
  0x938ABA3A, 0x23A25001, 0x37D10000, 0x1301C1CC, 
  0x639E2A18, 0x6F008000, 0x6F008001, 0x37DB0000, 
  0x130BCBCC, 0xEFF45FFF, 0x372B0100, 0x130BBB3A, 
  0x23A46001, 0x37D10000, 0x1301C1CC, 0x63182B16, 
  0xB7DB0000, 0x938BCBCC, 0x6F04C000, 0xB72B0100, 
  0x938BBB3A, 0x23A67001, 0x37D10000, 0x1301C1CC, 
  0x63962B14, 0x37DC0000, 0x130CCCCC, 0xEF03C000, 
  0x372C0100, 0x130CBC3A, 0x23A88001, 0x37D10000, 
  0x1301C1CC, 0x63142C12, 0x97000020, 0x9380C0C8, 
  0xB7DC0000, 0x938CCCCC, 0x6F03C000, 0xB72C0100, 
  0x938CBC3A, 0x23A09001, 0xB7D30000, 0x9383C3CC, 
  0x639E7C0E, 0x37DD0000, 0x130DCDCC, 0xEF02C000, 
  0x372D0100, 0x130DBD3A, 0x23A2A001, 0xB7D30000, 
  0x9383C3CC, 0x631C7D0C, 0x6F008000, 0x6F008001, 
  0xB7DD0000, 0x938DCDCC, 0x6FF25FFF, 0xB72D0100, 
  0x938DBD3A, 0x23A4B001, 0xB7D30000, 0x9383C3CC, 
  0x63967D0A, 0x37DE0000, 0x130ECECC, 0xEF01C000, 
  0x372E0100, 0x130EBE3A, 0x23A6C001, 0xB7D30000, 
  0x9383C3CC, 0x63147E08, 0xB7DE0000, 0x938ECECC, 
  0x6F01C000, 0xB72E0100, 0x938EBE3A, 0x23A8D001, 
  0xB7D30000, 0x9383C3CC, 0x63927E06, 0x17010020, 
  0x1301C1BD, 0x37DF0000, 0x130FCFCC, 0xEF00C000, 
  0x372F0100, 0x130FBF3A, 0x2320E101, 0xB7D10000, 
  0x9381C1CC, 0x631C3F02, 0xB7DF0000, 0x938FCFCC, 
  0x6F00C000, 0xB72F0100, 0x938FBF3A, 0x2322F101, 
  0xB7D10000, 0x9381C1CC, 0x639A3F00, 0x0F00F00F, 
  0x9308D005, 0x13050000, 0x6FF05FFF, 0x0F00F00F, 
  0x9308D005, 0x37150000, 0x1305D5BA, 0x6FF01FFF, 
  0x731000C0, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000
] )

# Simulated initialized RAM image:
jal_ram = ram_img( [
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 
  0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x80000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000, 
  0x00000000, 0x00000000, 0x00000000, 0x00000000
] )

# Expected 'pass' register values.
jal_exp = {
  1024: [ { 'r': 17, 'e': 93 }, { 'r': 10, 'e': 0 } ],  'end': 1024
}

# Collected test program definition:
jal_test = [ 'JAL compliance tests', 'cpu_jal', jal_rom, jal_ram, jal_exp ]